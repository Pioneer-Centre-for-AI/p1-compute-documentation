---
export interface Props {
  /**
   * Whether to show compute-specific support options
   */
  showComputeCoordinator?: boolean;
  /**
   * Whether to show HPC gouvernance board Member option
   */
  showHpcGouvernanceBoard?: boolean;
  /**
   * Technical support email (HPC facility support team)
   */
  technicalSupportEmail?: string;
  /**
   * Technical support label (e.g., "HPC Support Team", "Technical Admin")
   */
  technicalSupportLabel?: string;
  /**
   * Compute coordinator email (defaults to technical support email if not provided)
   */
  computeCoordinatorEmail?: string;
  /**
   * Custom email subject prefix (e.g., "Gefion Support:", "DTU HPC:")
   */
  emailSubjectPrefix?: string;
  /**
   * Additional support items to include
   */
  additionalItems?: Array<{
    label: string;
    description: string;
    contact: string;
    icon?: string;
  }>;
}

const {
  showComputeCoordinator = true,
  showHpcGouvernanceBoard = true,
  technicalSupportEmail = "support@hpc-facility.dk",
  technicalSupportLabel = "HPC Support Team",
  computeCoordinatorEmail = "bstja@dtu.dk",
  emailSubjectPrefix = "",
  additionalItems = []
} = Astro.props;

// Helper function to create mailto URL with subject
const createMailtoUrl = (email: string, subjectSuffix: string = "", customPrefix?: string) => {
  const prefix = customPrefix || emailSubjectPrefix;
  if (!prefix && !subjectSuffix) {
    return `mailto:${email}`;
  }
  const subject = `${prefix}${subjectSuffix ? ` ${subjectSuffix}` : ''}`.trim();
  return `mailto:${email}?subject=${encodeURIComponent(subject)}`;
};

const supportItems = [
  {
    icon: "technical",
    label: "Technical Support",
    description: "For technical issues, contact the",
    contact: technicalSupportEmail,
    contactLabel: technicalSupportLabel
  },
  {
    icon: "policy",
    label: "Policy Support",
    description: "For policy issues, contact",
    contact: "compute-governance-p1@aicentre.dk",
    contactLabel: "compute-governance-p1@aicentre.dk"
  },
  {
    icon: "chat",
    label: "General Questions",
    description: "Use the #compute or #ask-compute channels on P1 Slack",
    contact: null,
    contactLabel: null
  }
];

if (showComputeCoordinator) {
  supportItems.push({
    icon: "person",
    label: "Compute Coordinator",
    description: "Contact",
    contact: computeCoordinatorEmail,
    contactLabel: computeCoordinatorEmail
  });
}

// Icon components
const getIcon = (iconType: string) => {
  switch (iconType) {
    case "technical":
      return `<svg class="support-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
      </svg>`;
    case "policy":
      return `<svg class="support-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
        <polyline points="14,2 14,8 20,8"/>
        <line x1="16" y1="13" x2="8" y2="13"/>
        <line x1="16" y1="17" x2="8" y2="17"/>
        <polyline points="10,9 9,9 8,9"/>
      </svg>`;
    case "chat":
      return `<svg class="support-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
      </svg>`;
    case "person":
      return `<svg class="support-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
        <circle cx="12" cy="7" r="4"/>
      </svg>`;
    case "group":
      return `<svg class="support-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
        <circle cx="9" cy="7" r="4"/>
        <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
      </svg>`;
    default:
      return `<svg class="support-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
      </svg>`;
  }
};
---

<div class="not-content my-6">
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
    {supportItems.map((item) => (
      <div class="bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded-xl p-6 transition-all duration-300 hover:-translate-y-0.5 hover:shadow-lg hover:border-blue-300 dark:hover:border-blue-600">
        <div class="flex items-center gap-3 mb-3">
          <div class="text-blue-600 dark:text-blue-400 flex-shrink-0" set:html={getIcon(item.icon)} />
          <h3 class="font-semibold text-lg text-slate-900 dark:text-slate-100 m-0">
            {item.label}
          </h3>
        </div>
        <div class="text-slate-600 dark:text-slate-400 leading-relaxed">
          {item.label === "General Questions" ? (
            <>
              Use the{' '}
              <a
                href="https://pioneercentreforai.slack.com/channels/compute"
                target="_blank"
                rel="noopener noreferrer"
                class="bg-slate-200 dark:bg-slate-700 px-1 py-0.5 rounded font-mono text-sm text-slate-800 dark:text-slate-200 no-underline hover:bg-blue-600 hover:text-white transition-colors duration-200"
              >
                #compute
              </a> or{' '}
              <a
                href="https://pioneercentreforai.slack.com/channels/ask-compute"
                target="_blank"
                rel="noopener noreferrer"
                class="bg-slate-200 dark:bg-slate-700 px-1 py-0.5 rounded font-mono text-sm text-slate-800 dark:text-slate-200 no-underline hover:bg-blue-600 hover:text-white transition-colors duration-200"
              >
                #ask-compute
              </a>
              {' '}channels on P1 Slack
            </>
          ) : (
            <>
              {item.description}{' '}
              {item.contact && (
                <>
                  <a
                    href={item.label === "Technical Support"
                      ? createMailtoUrl(item.contact, "Technical Issue")
                      : item.label === "Compute Coordinator"
                      ? createMailtoUrl(item.contact, "General Inquiry")
                      : item.label === "Policy Support"
                      ? createMailtoUrl(item.contact, "Policy Question")
                      : createMailtoUrl(item.contact)
                    }
                    class="text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 font-medium no-underline hover:underline transition-colors duration-200"
                  >
                    {item.contactLabel}
                  </a>
                  {item.label === "Compute Coordinator" && (
                    <span> for general or technical compute-related questions</span>
                  )}
                </>
              )}
            </>
          )}
        </div>
      </div>
    ))}

    {additionalItems.map((item) => (
      <div class="bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded-xl p-6 transition-all duration-300 hover:-translate-y-0.5 hover:shadow-lg hover:border-blue-300 dark:hover:border-blue-600">
        <div class="flex items-center gap-3 mb-3">
          <div class="text-blue-600 dark:text-blue-400 flex-shrink-0" set:html={getIcon(item.icon || "technical")} />
          <h3 class="font-semibold text-lg text-slate-900 dark:text-slate-100 m-0">
            {item.label}
          </h3>
        </div>
        <div class="text-slate-600 dark:text-slate-400 leading-relaxed">
          {item.description}{' '}
          <a
            href={createMailtoUrl(
              item.contact.startsWith('mailto:') ? item.contact.replace('mailto:', '') : item.contact,
              "Support Request"
            )}
            class="text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 font-medium no-underline hover:underline transition-colors duration-200"
          >
            {item.contact.replace('mailto:', '')}
          </a>
        </div>
      </div>
    ))}
  </div>
</div>
